# .kiro/standards-config.yml
# Configuration for loading development standards

defaults:
  # Standards loaded in every Kiro session
  core_standards:
    - standards/quick-reference.md
    - standards/core/priority-framework.md
    - standards/core/when-not-to-apply.md
    - standards/core/ai-behavior.md

  # Quick reference always available
  quick_reference: standards/quick-reference.md

  # Language-specific standards
  typescript:
    - standards/typescript/style.md
    - standards/typescript/architecture.md

  # Library-specific standards
  libraries:
    - standards/libraries/prisma.md
    - standards/libraries/nextjs.md
    - standards/libraries/zod.md

  # Project memory for AI context
  memory:
    - memory/decisions.md
    - memory/glossary.yml

  # Validation rules for AI code generation
  validation_rules: validation/rules.yml

contexts:
  # Auto-load standards based on file patterns
  typescript:
    patterns:
      - '**/*.ts'
      - '**/*.tsx'
    standards:
      - standards/typescript/style.md
      - standards/typescript/architecture.md
    description: 'TypeScript files - style and architecture patterns'

  services:
    patterns:
      - 'src/services/**/*.ts'
    standards:
      - standards/quick-reference.md
      - standards/typescript/architecture.md
      - standards/libraries/prisma.md
      - standards/libraries/zod.md
      - standards/domain/errors.md
    description: 'Business logic with transactions and error handling'

  repositories:
    patterns:
      - 'src/repositories/**/*.ts'
    standards:
      - standards/quick-reference.md
      - standards/typescript/architecture.md
      - standards/libraries/prisma.md
      - standards/domain/performance.md
    description: 'Data access layer with database operations'

  api_routes:
    patterns:
      - 'src/pages/api/**/*.ts'
      - 'app/api/**/*.ts'
    standards:
      - standards/libraries/nextjs.md
      - standards/libraries/zod.md
      - standards/domain/errors.md
    description: 'Next.js API routes'

  pages:
    patterns:
      - 'src/pages/**/*.tsx'
      - 'app/**/*.tsx'
    standards:
      - standards/libraries/nextjs.md
      - standards/typescript/style.md
    description: 'Next.js pages and components'

  controllers:
    patterns:
      - 'src/controllers/**/*.ts'
    standards:
      - standards/domain/errors.md
      - standards/domain/file-organization.md
    description: 'API request handlers'

  tests:
    patterns:
      - '**/*.test.ts'
      - '**/*.spec.ts'
      - 'src/__tests__/**/*.ts'
    standards:
      - standards/quick-reference.md
      - standards/domain/testing-mocks.md
    description: 'Test files'

  utilities:
    patterns:
      - 'src/utils/**/*.ts'
      - 'src/hooks/**/*.ts'
    standards:
      - standards/core/when-not-to-apply.md
      - standards/domain/comments.md
    description: 'Utility functions and custom hooks'

  documentation:
    patterns:
      - 'README.md'
      - '**/*.mdx'
      - '.kiro/**/*.md'
    standards:
      - standards/domain/comments.md
    description: 'Documentation files'

workflows:
  # Workflows that load specific standards
  code_review:
    standards:
      - standards/quick-reference.md
      - standards/core/priority-framework.md
    command: 'kiro review'

  feature_development:
    standards:
      - standards/quick-reference.md
      - standards/core/priority-framework.md
      - standards/domain/errors.md
    command: 'kiro create'

  performance_optimization:
    standards:
      - standards/domain/performance.md
      - standards/core/priority-framework.md
    command: 'kiro optimize'

  refactoring:
    standards:
      - standards/core/when-not-to-apply.md
      - standards/core/priority-framework.md
    command: 'kiro refactor'

validation:
  # Rules that must pass before commit
  required:
    - name: 'ESLint'
      command: 'npm run lint'
      fail_on_warnings: true

    - name: 'TypeScript'
      command: 'tsc --noEmit'
      fail_on_error: true

    - name: 'Tests'
      command: 'npm test'
      fail_on_error: true

  checklists:
    # Run these checklists during validation
    - standards/quick-reference.md

red_flags:
  # Patterns that should trigger immediate review
  patterns:
    - pattern: 'prisma.*.(update|create|delete)'
      not_inside: '$transaction'
      severity: 'critical'
      message: 'Database write outside transaction'
      reference: 'standards/quick-reference.md#critical-rules'

    - pattern: '.reduce('
      without: ", \\w+\\)"
      severity: 'high'
      message: 'reduce() without initial value'
      reference: 'standards/quick-reference.md#variable-initialization'

    - pattern: "throw new Error\\("
      severity: 'medium'
      message: 'Generic Error instead of specific error class'
      reference: 'standards/domain/errors.md'

    - pattern: "await prisma\\..+\\.findUnique"
      inside: 'for|while'
      severity: 'critical'
      message: 'N+1 query problem'
      reference: 'standards/domain/performance.md#n1-queries'
